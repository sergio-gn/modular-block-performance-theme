<style>
    :root {
      --marginXBase: 10px;
      --marginYBase: 10px;
    }
    .container {
      display: flex;
      flex-flow: row wrap;
      justify-content: center;
      align-items: stretch;
      align-content: flex-start;
      gap: var(--marginXBase) var(--marginYBase);
      outline: 1px solid black;
    }
    .item {
      background-color: blue;
      min-height: 15px;
      /* default to 3up */
      flex: 0 0 calc(33.33% - (var(--marginXBase) * 2) / 3);
    }
    .x-2up {
      background-color: green;
      flex: 0 0 calc(50% - (var(--marginXBase) * 1) / 2);
    }
    .x-4up {
      background-color: red;
      flex: 0 0 calc(25% - (var(--marginXBase) * 3) / 4);
    }
    </style>
    
    <div class="container">
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
      <div class="item"></div>
    </div>
    
    <br>
    
    <div class="container">
      <div class="item x-2up"></div>
      <div class="item x-2up"></div>
      <div class="item x-2up"></div>
      <div class="item x-2up"></div>
      <div class="item x-2up"></div>
    </div>
    
    <br>
    
    <div class="container">
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
      <div class="item x-4up"></div>
    </div>